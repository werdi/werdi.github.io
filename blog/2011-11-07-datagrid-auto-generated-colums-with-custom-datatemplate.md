---
title: DataGrid Auto Generated Columns with Custom DataTemplate
tags: [c3, xaml, wpf]
src: https://social.msdn.microsoft.com/Forums/ru-RU/0794da85-cf98-4367-8214-2d25645e37c1/datagrid-auto-generated-colums-with-custom-datatemplate?forum=wpf
---
# DataGrid Auto Generated Columns with Custom DataTemplate
*> Don't know number of columns to be displayed in the DataGrid at compile time [...]  i am using AutoGenerateColums [...] i want to use Custom DataTemplate for some columns*

it possible if handle AutoGeneratingColumns and AutoGeneratedColumns events. below is an example, which sets the template and style for columns.
```xaml
<Window x:Class="WpfApplication5.MainWindow"
  xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
  xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
  xmlns:local="clr-namespace:WpfApplication5"
  Title="MainWindow" Height="350" Width="525">
  <StackPanel>
    <Button Content="Test" Click="Button_Click" HorizontalAlignment="Left" />
    <DataGrid AutoGenerateColumns="True" ItemsSource="{Binding}" x:Name="dg" 
      AutoGeneratingColumn="dg_AutoGeneratingColumn"
      AutoGeneratedColumns="dg_AutoGeneratedColumns" />
  </StackPanel>
</Window>
```
```c# 
using System;
using System.Data;
using System.Linq;
using System.Windows;
using System.Windows.Controls;
using System.Windows.Media;
using System.Windows.Data;

namespace WpfApplication5
{
  public partial class MainWindow : Window
  {
    public MainWindow()
    {
      InitializeComponent();
    }

    private void Button_Click(object sender, RoutedEventArgs e)
    {
      var rnd = new Random();
      var dt = new DataTable();
      for (int i = 0; i < rnd.Next(5, 12); i++)
        dt.Columns.Add("col" + i, typeof(int));

      var arr = new object[dt.Columns.Count];
      for (int i = 0; i < rnd.Next(5, 15); i++)
      {
        for (int j = 0; j < arr.Length; j++) arr[j] = rnd.Next(0, 100);
        dt.Rows.Add(arr);
      }
      this.DataContext = dt.DefaultView;
  }

  private void dg_AutoGeneratedColumns(object sender, EventArgs e)
  {
      var rnd = new Random();
      var brushes = typeof(Brushes).GetProperties().Select(pi => (Brush) pi.GetValue(null, null)).ToArray();
      for (int i = 0; i < dg.Columns.Count; i++)
      {
        var c = dg.Columns[i];
        if (c.DisplayIndex % 2 == 0)
        {
          var brush = brushes[rnd.Next(0, brushes.Length)];
          var s = new Style() { TargetType = typeof(DataGridCell) };
          s.Setters.Add(new Setter(DataGridCell.BackgroundProperty, brush));
          c.CellStyle = s;
        }
      }
    }

    private void dg_AutoGeneratingColumn(object sender, DataGridAutoGeneratingColumnEventArgs e)
    {
      if((string)e.Column.Header == "col2")
      {
        var f = new FrameworkElementFactory(typeof(TextBox));
        f.SetValue(TextBox.TextAlignmentProperty, TextAlignment.Right);
        f.SetValue(TextBox.TextProperty, new Binding("[0]"));
        e.Column = new DataGridTemplateColumn() 
        {
          Header = e.Column.Header,
          Width = 100,
          CellTemplate = new DataTemplate() { VisualTree = f },
        };
      }
    }
  }
}
```